<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Monetag Login</title>
</head>
<body>
  <h2>লগইন বা সাইন আপ করুন</h2>
  <input id="email" placeholder="Email"><br><br>
  <input id="password" type="password" placeholder="Password"><br><br>
  <button onclick="signup()">Sign Up</button>
  <button onclick="login()">Login</button>

  <script type="module">
    import { auth, db } from './firebase.js';
    import { createUserWithEmailAndPassword, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    async function signup() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const refBy = new URLSearchParams(window.location.search).get('ref') || "";
      const user = await createUserWithEmailAndPassword(auth, email, password);
      await setDoc(doc(db, 'users', user.user.uid), { email, balance: 0, refBy });
      if (refBy) {
        const refUser = doc(db, 'users', refBy);
        const refSnap = await getDoc(refUser);
        if (refSnap.exists()) {
          await setDoc(refUser, { balance: refSnap.data().balance + 1 }, { merge: true });
        }
      }
      localStorage.setItem('uid', user.user.uid);
      window.location.href = 'dashboard.html';
    }

    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const user = await signInWithEmailAndPassword(auth, email, password);
      localStorage.setItem('uid', user.user.uid);
      window.location.href = 'dashboard.html';
    }
  </script>
</body>
</html>